<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.128.0"><title>Summary: Assignment Expressions - PEP 572 &#183; Coding Notes</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/2.0.6/pure-min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/2.0.6/grids-responsive-min.css><link rel=stylesheet href=https://pbedn.github.io/css/side-menu.css><link rel=stylesheet href=https://pbedn.github.io/css/blackburn.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css?family=Raleway" rel=stylesheet type=text/css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js></script><link rel="shortcut icon" href=https://pbedn.github.io/img/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVR0TPVEEJ"></script><script>if(window.location.hostname!="localhost"){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JVR0TPVEEJ")}</script></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=https://pbedn.github.io/>PBedn</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://pbedn.github.io/><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://pbedn.github.io/archives/><i class='fa fa-list fa-fw'></i>Archives</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://pbedn.github.io/about/><i class='fa fa-user fa-fw'></i>About</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://pbedn.github.io/projects/><i class='fa fa-cog fa-fw'></i>Projects</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://pbedn.github.io/books/><i class='fa fa-book fa-fw'></i>Books</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://linkedin.com/in/pbedn target=_blank><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://github.com/pbedn target=_blank><i class="fa fa-github-square fa-fw"></i>GitHub</a></li></ul></div><div><div class=small-print><small>&#169; 2021 Pawel Bednarz</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div><div><input id=highlight type=button value="Highlight Code Dark" class=pure-button style=font-size:65%;background:#999;text-align:center></div></div><div id=main><main><div class=header><h2>Summary: Assignment Expressions - PEP 572</h2><h3></h3></div><div class=content><div class=post-meta><div class=dark-color><i class="fa fa-calendar fa-fw"></i>
<time>28 Jul 2019</time>
.. <i class="fa fa-clock-o" aria-hidden=true>4 min</i></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=https://pbedn.github.io/tags/python>python</a>&nbsp;/
<a class=post-taxonomy-tag href=https://pbedn.github.io/tags/python-3.8+>python 3.8+</a></div></div><p>The famous PEP 572, and one of the reasons Guido Van Rossum - Python BDFL - retired from decision process (stepped down as BDFL).
It is called &ldquo;Assignment Expressions&rdquo;, and is about adding new syntax := that will allow assign to variables
within an expression.</p><h3 id=assignment-expressions-operator>Assignment Expressions Operator</h3><p>First, let&rsquo;s look at the difference in Python between assignment statement and assignment expression:</p><p>Assignment statements are used to associate names of variables with values or to modify attributes of items in mutable objects.</p><p>Assignment expression is a way to assign to variables within an expression, using the new operator := .
It will look like this: <em>NAME := expression</em>. It can be used in almost all places where assignment statements are (using parentheses). They additionally work fine
in lambda functions and comprehensions. In terms of limits, there are cases where they are not supported, and even more,
cases where usage is not recommended, though possible.</p><h4 id=syntax>SYNTAX</h4><p>Assignement expression syntax examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Handle a matched regex</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>match</span> <span style=color:#f92672>:=</span> pattern<span style=color:#f92672>.</span>search(data)) <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Do something with match</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># A loop that can&#39;t be trivially rewritten using 2-arg iter()</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> chunk <span style=color:#f92672>:=</span> file<span style=color:#f92672>.</span>read(<span style=color:#ae81ff>8192</span>):
</span></span><span style=display:flex><span>   process(chunk)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reuse a value that&#39;s expensive to compute</span>
</span></span><span style=display:flex><span>[y <span style=color:#f92672>:=</span> f(x), y<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>, y<span style=color:#f92672>**</span><span style=color:#ae81ff>3</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Share a subexpression between a comprehension filter clause and its output</span>
</span></span><span style=display:flex><span>filtered_data <span style=color:#f92672>=</span> [y <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> data <span style=color:#66d9ef>if</span> (y <span style=color:#f92672>:=</span> f(x)) <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>]
</span></span></code></pre></div><p>As we see, they might be useful to short required lines of code. It is familiar for people coming from, for example, C world.</p><h4 id=valid-and-invalid>VALID AND INVALID</h4><p>Lets look at some valid and invalid examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>y <span style=color:#f92672>:=</span> f(x)  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>(y <span style=color:#f92672>:=</span> f(x))  <span style=color:#75715e># Valid, though not recommended</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>y0 <span style=color:#f92672>=</span> y1 <span style=color:#f92672>:=</span> f(x)  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>y0 <span style=color:#f92672>=</span> (y1 <span style=color:#f92672>:=</span> f(x))  <span style=color:#75715e># Valid, though discouraged</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>foo(x <span style=color:#f92672>=</span> y <span style=color:#f92672>:=</span> f(x))  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>foo(x<span style=color:#f92672>=</span>(y <span style=color:#f92672>:=</span> f(x)))  <span style=color:#75715e># Valid, though probably confusing</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer <span style=color:#f92672>=</span> p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span>):  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer<span style=color:#f92672>=</span>(p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span>)):  <span style=color:#75715e># Valid, though not great style</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer: p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>):  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer: (p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>):  <span style=color:#75715e># Valid, but probably never useful</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>lambda</span>: x <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>) <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>lambda</span>: (x <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>) <span style=color:#75715e># Valid, but unlikely to be useful</span>
</span></span><span style=display:flex><span>(x <span style=color:#f92672>:=</span> <span style=color:#66d9ef>lambda</span>: <span style=color:#ae81ff>1</span>) <span style=color:#75715e># Valid</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>lambda</span> line: (m <span style=color:#f92672>:=</span> re<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(pattern, line)) <span style=color:#f92672>and</span> m<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>) <span style=color:#75715e># Valid</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>(x<span style=color:#f92672>:=</span><span style=color:#ae81ff>10</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>  <span style=color:#75715e># Valid, uses assignment expression</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;10&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>x<span style=color:#e6db74>:</span><span style=color:#e6db74>=10</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>    <span style=color:#75715e># Valid, passes &#39;=10&#39; to formatter</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;        10&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer <span style=color:#f92672>=</span> p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span>):  <span style=color:#75715e># INVALID</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>foo</span>(answer<span style=color:#f92672>=</span>(p <span style=color:#f92672>:=</span> <span style=color:#ae81ff>42</span>)):  <span style=color:#75715e># Valid, though not great style</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    
</span></span></code></pre></div><h4 id=scope>SCOPE</h4><p>An assignment expression does not introduce a new scope. It is using the current one.
And honors nonlocal or global declaration. A lambda is a scope for assignement expression.
The same rule is for comprehensions. Assignment expression binds the target in the containing scope.</p><p>Example how to capture and use later a variable inside any and all.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> any((comment <span style=color:#f92672>:=</span> line)<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;#&#39;</span>) <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;First comment:&#34;</span>, comment)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;There are no comments&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> all((nonblank <span style=color:#f92672>:=</span> line)<span style=color:#f92672>.</span>strip() <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> lines):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;All lines are blank&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;First non-blank line:&#34;</span>, nonblank)
</span></span></code></pre></div><p>Example how to update a mutable state inside a comprehension. Here we compute a partial sums in list comprehension.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>total <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>partial_sums <span style=color:#f92672>=</span> [total <span style=color:#f92672>:=</span> total <span style=color:#f92672>+</span> v <span style=color:#66d9ef>for</span> v <span style=color:#f92672>in</span> values]
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Total:&#34;</span>, total)
</span></span></code></pre></div><h3 id=controversy>Controversy</h3><p>Up to this point, Guido Van Rossum as Python BDFL was in charge of accepting PEPs.
Of course, he had BDFL Delegates that were helping with PEPs and other stuff.
But all discussions and controversy made him tired of fighting for this PEP.
As a result (at least partially) he stepped down as BDFL and removed himself from the decision process.
PEP 572 started discussions about new direction and leaders for the Python community.
And the result was a change of Python governance that is described more in <a href=https://www.python.org/dev/peps/pep-8016/ target=_blank>PEP 8016</a>.
However, Guido only temporarily lost his superpowers.
A year later, on one of the conferences, he said that because Python is his child,
he cannot stay entirely outside.
Currently, he serves as one of five Steering Council members, elected in February 2019.</p><h3 id=my-opinion>My Opinion</h3><p>I have not a chance to use that operator, and will not for some time. But when I will, I think it might serve its purpose.
Python code (almost pseudocode) was always much shorter than other languages. That makes it even better.
After the first cry, developers will get used to and start to exploit its features.</p><hr><p>References:</p><ul><li><a href=https://www.python.org/dev/peps/pep-0572/ target=_blank>Link to PEP 572</a></li><li><a href=https://www.python.org/dev/peps/pep-8016/ target=_blank>Link to PEP 8016</a></li><li><a href="https://www.youtube.com/watch?v=6uAvHOKofws" target=_blank>Dustin Ingram - PEP 572: The Walrus Operator - PyCon 2019</a></li><li><a href=https://lwn.net/Articles/757713/ target=_blank>PEP 572 and decision-making in Python</a></li></ul><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=https://pbedn.github.io/post/2019-06-07-python-pep-summary-2/><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=https://pbedn.github.io/post/2019-06-07-python-pep-summary-2/>Summary: Python Positional-Only Parameters - PEP 570</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=https://pbedn.github.io/post/2019-08-21-parametrize-pytest/>Parametrizing tests with pytest</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=https://pbedn.github.io/post/2019-08-21-parametrize-pytest/><i class="fa fa-chevron-right"></i></a></div></div></div></main></div></div><footer><script src=https://pbedn.github.io/js/ui.js></script><script src=https://pbedn.github.io/js/menus.js></script><script type=text/javascript>$("#highlight").click(function(){$("head").append('<link href="https://pbedn.github.io/css/atom-one-dark.css" rel="stylesheet" id="mycss"/>')})</script></footer></body></html>